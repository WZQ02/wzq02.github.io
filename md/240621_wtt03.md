# 【wzqtechtips#03】手机压片，可行否？

<notice>本文中提供的数据仅供参考。</notice>

## 前言

前段时间，因为我以前的红米 K30 手机在运行当今的各种流氓国产应用时经常出现卡顿，比如说打开个微信小程序都要等半天，6GB+128GB 的内存和存储配置对于我目前的使用需求也显得捉襟见肘，考虑到我即将工作，需要一部反应速度足够快的手机应对工作需求，正好这段时间也是各大电商 618 活动的进行时，各类电子产品都在做促销活动，我便购置了一部小米 13 作为我的主力手机，并把我原来手机上的数据也都转移了过去。

作为一名 B 站 UP 主（姑且算是吧），我经常会有视频剪辑方面的需求~~（指制作鬼畜音 MAD）~~，而在整个视频剪辑的流程中，最后一步往往就是导出视频，而视频的导出，离不开要对视频进行编码压制。我个人在剪辑软件里面导出视频时一般会使用到 Voukoder 插件，这个插件可以调用开源的 x264、x265 视频编码器，并且可以根据我的需要调节视频的各项压制参数，这样我就可以尽可能得到体积小，且高画质的视频。

关注了我[小号](https://space.bilibili.com/568299236/)的应该知道，这几年我也对国内音 MAD 社群的各种直播活动进行录播，其中也涉及到视频压制的步骤（主要是为了把直播弹幕压制进视频画面内）。可以说，压制视频确实是我这些年来在电脑上最经常会干的事情之一了。

视频的压制，或者说编码，对于电脑硬件性能的要求是比较高的。我自己主力台式机的 CPU 是发布于 2020 年的 10 代酷睿 i7，在这颗 CPU 上使用 x265 软件编码器的默认参数转换一个 4K 分辨率的视频，帧率只能达到每秒 10 帧左右。不过我也因此想到，这些年智能手机的 CPU 进步的越来越快，近两年手机端旗舰 CPU 的性能已经能够比肩早些年的轻薄本，那如果让手机去运行这些视频压制的任务，速度会有多快？

小米 13 搭载的处理器是高通骁龙的上一代旗舰 CPU，骁龙 8 Gen 2。对数码圈子比较熟悉的应该知道，这代骁龙 CPU 在性能和能效上都有不错的水平。而我上一部手机则搭载骁龙 765G 处理器，放在当年也是还不错的手机 CPU，但是在国产手机应用日渐臃肿的当下，已经有些不好使了。

## 测试内容

那么，如何直观的去对比手机和电脑的视频压制性能呢？这里我就要请出大名鼎鼎的 FFmpeg 软件了。

<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/FFmpeg_Logo_new.svg/200px-FFmpeg_Logo_new.svg.png" class="allowinvert" alt="FFmpeg"></p>

熟悉视频压制领域的应该都用到过这个软件，它集成了各种常用的开源音视频编解码库，包括上文提到的 x264、x265 等。我可以直接在 FFmpeg 命令行中调用这些编码库，用一行命令就搞定视频的压制流程。同时，这个软件拥有良好的跨平台支持，它既可以跑在我的电脑上，也可以跑在我手机的 Termux 环境里面。是的，本次测试中，我就用这款软件来对比手机和电脑的视频压制性能。

在参与测试的硬件中，除了我上文提到的我的两部手机和我的主力台式机，我也把我以前用的，十多年前的双核 2 代 i3 旧电脑拉入了测试当中，毕竟我曾经也在那台电脑上做过视频剪辑和压制。
### Part 1：CPU 视频编码性能对比

#### x264 软件视频编码

首先是 H.264 视频编码的部分。x264 至今仍是最被广泛使用的软件 H.264 视频编码器，在使用 FFmpeg 编码 MP4 格式的视频时，默认情况下就会调用 x264 编码器进行视频编码。我准备了两个时长 1 分钟，规格为 1080p 24 帧 / 秒的视频片段，在电脑端的 FFmpeg 7.0 和手机 Termux 环境上的 FFmpeg 6.1 上以相同参数转换这两个视频，结果如下：

片段 1：电影《奥本海默》截取片段，1080p 24fps，8bit 色深，编码使用 x264 medium 预设

![](https://img.wzq02.top/upl/f6a8fda8ffce2d59fb54b88a81273b10.webp)

<p><img src="https://img.wzq02.top/upl/8ca27928ec2da079842e580b66b0da9e.png" class="allowinvert" width="720"></p>

其中速度最快的毫无疑问是我现在的电脑 CPU，编码第一个视频片段的速度为 85fps；第二名则是我现在的手机 CPU 骁龙 8 Gen 2，速度为 31fps，这个速度已经达到实时编码的水平了；接下来是我的旧手机和旧电脑，这两个设备的 CPU 编码速度均为 12fps 左右，相差不大。不过我有点没想到我旧手机 CPU 的编码速度居然已经跟我的旧电脑差不多快了。

片段 2：MV 《Help me, ERINNNNNN!!》 截取片段，1080p 24fps，8bit 色深，编码使用 x264 medium 预设

![](https://img.wzq02.top/upl/23bd1b4c25bb32e5218dbd201f5f258f.webp)

<p><img src="https://img.wzq02.top/upl/2a3d4628a3678ac13fe885b7d91f37b9.png" class="allowinvert" width="720"></p>

同样，我的台式电脑 CPU 毫无悬念地拔得头筹，速度为 63fps，8 Gen 2 则为 23fps，2 代 i3 和 765G 的速度则分别为 9.5fps 和 8.7fps。

综合来看，以我旧手机骁龙 765G CPU 的编码速度为基准，这四台设备的速度比例大概是这么个水平：

<p><img src="https://img.wzq02.top/upl/ce80c14927c3f6d6be59f9b5aa9fa69e.png" class="allowinvert" width="720"></p>

由此可见 8 Gen 2 的 CPU 性能确实不错，在手机个位数瓦（W）的功耗下，视频编码速度就已经比肩 10 年前的 4 代酷睿 i7 CPU，更是把我以前用的 2 代 i3 电脑完全吊着打，要知道我以前甚至在那台电脑上用 After Effects 做过视频后期呢~~（虽然做得很简单粗糙就是了）~~，更别说手机上的 ARM 架构 CPU 属于精简指令集，在视频编码这种复杂任务中本身就占劣势。

#### x265 软件视频编码

不过，H.264 作为 2003 年发布的视频编码格式，在当今 4K 清晰度网络视频遍地开花的环境下已经显露颓势，x264 编码器的潜力也几乎早就被挖掘完全。那我这次的测试当然也要引入 H.265 视频编码，这里我使用同样被广泛采用的 x265 视频编码器。在使用 FFmpeg 编码 MP4 格式的视频时，命令行参数中加入一句 ```-c:v libx265``` 即可调用 x265 编码器压制视频。我在此准备了一段时长 1 分钟，分辨率 1920x800，24 帧 / 秒的视频片段，同样是在电脑和手机上的 FFmpeg 上以完全相同的参数转换这个视频，结果如下：

片段 3：电影《黑客帝国 2》截取片段，1920x800 24fps，8bit 色深，编码使用 x265 medium 预设

![](https://img.wzq02.top/upl/341ea9508e8123dbd2fa226d713df327.webp)

<p><img src="https://img.wzq02.top/upl/cb12e5cef9bed39af486b0d165e68518.png" class="allowinvert" width="720"></p>

相较于 x264 编码，我的两个 x86 架构台式机 CPU 在 x265 编码中比起手机似乎更占优势一点，十代 i7 的编码速度为 49.87fps，约为我旧手机（骁龙 765G）的 7.52 倍，新手机（8 Gen 2）的 2.73 倍。我旧电脑二代 i3 的速度为 7.57fps，是 765G（6.63fps）的 1.14 倍，相比前面的 x264 测试差距稍微更大一点。总体而言，以现在手机 CPU 的性能，在不方便使用电脑的情况下拿来跑非实时的视频压制是可行的，至少从我手头这颗 8 Gen 2 来说，它的纯软件视频编码性能已经能达到八、九年前台式机中端四核 CPU 的水平了。

### Part 2：硬件视频编码

但归根结底，CPU 作为通用计算处理器，它编码视频的速度实在是有点慢了。即使是仅仅四年前的十代 i7，如上文所述，其编码 1080p H.265 视频的速度也不过数十帧，而如果是编码 4K 视频，帧率则更是只有 10 帧左右。对于视频直播、视频拍摄这些需要实时编码视频的场景，这样的速度显然是不够看的，因此，现如今的手机芯片和电脑显卡都内置了专用的视频编解码单元，如 NVIDIA 显卡的 NVENC 编码单元，以满足这些需要实时编码的需求。相比起 CPU 编码，这些专用的硬件编码器压制视频的速度能比 CPU 快上几十倍，同时不怎么占用手机和电脑的 CPU 资源。

但是！有压片经验的都知道，硬件编码器虽然速度快，压制出来的视频画质并不一定好，同样的码率下，硬件编码器转出来的视频，画质可能会比 CPU 差上许多。不过老黄家显卡的 NVENC 编码单元也经历过几次升级，尤其是从 16、20 系 Turing 架构显卡开始，显卡编码视频的画质和压缩比已经能够与默认参数下的 x264、x265 软件编码器相接近了，在对压缩比和视频画质要求不苛刻的场合，使用 NVENC 取代软件编码，是完全可行的。我电脑上也有一张 Turing 架构的显卡（Geforce GTX 1660 SUPER），使用这张显卡的 NVENC 编码器编码 4K H.265 视频，速度能达到 100 帧以上，比 CPU 快了十多倍。

那么手机端的硬件编码器又是个什么情况呢？当下大多数主流价位的智能手机都可以轻松拍摄 4K 60fps 的视频，这就说明手机的硬件视频编码器可以实时编码 4K 60 帧的视频，这个速度显然要比 CPU 编码快得多，但手机编码器的视频画质，能不能达到 PC 端显卡甚至 CPU 的水平呢？

我发现，手机端的 FFmpeg 是可以调用手机的硬件编码器的，对于高通处理器的手机，只需要在 FFmpeg 命令行里面指定 ```-c:v h264_mediacodec``` 参数即可调用手机硬件编码器压制 H.264 视频，在 PC 端上，则使用 ```-c:v h264_nvenc``` 调用 N 卡 NVENC 编码器压制，这样一来我就可以直接对比手机、N 卡和 CPU 的编码效果了。

这里我又从电影《奥本海默》开头截取了一段时长一分半的视频片段，分别在我电脑上的 x264、x265 软件编码器、NVIDIA NVENC 编码器、以及手机上的 mediacodec 编码器压制同一段视频，使用 ```-b:v 2500k``` 参数将目标码率统一设置成 2.5 Mbps，对比这几个编码器的压制效果。

片段4：电影《奥本海默》截取片段，1080p 24fps，8bit 色深，均采用默认预设编码

![](https://img.wzq02.top/upl/2d8820968b8cb2ed1c1cd6740ab4cbd8.webp)

首先对比各个 H.264 视频编码器，先看下编码速度：

<p><img src="https://img.wzq02.top/upl/6129e0019bd987f28e7ac52eaafce927.png" class="allowinvert" width="720"></p>

x264 的速度仅为 87fps，而 NVENC 的速度达到了 421fps，比 CPU 编码快了将近 4 倍，而我手机上的骁龙 8 Gen 2 的硬件编码芯片也能跑到 251fps，也很快了。

那么，这几种编码器编码出来的视频画质如何呢？为了方便对这些视频的画质进行量化，这里我用到了 Netflix 在前些年发布的视频质量评估工具 VMAF，它可以通过将转换后的视频与原始视频进行比较，然后为转换后的视频进行打分。这个打分的取值范围为 0-100，100 分说明视频画面质量非常好，相比原视频没有任何损失，而 90 分以下的分数则意味着画面质量比较差，人能明显看出与原视频之间的区别。

我这次使用的测试视频长度为一分半，由于视频后半段的画面比前半段要更复杂，变化也更快，我分别测试了视频前 30 秒和后 30 秒的 VMAF 数值，先看前 30 秒的：

<p><img src="https://img.wzq02.top/upl/a3d188d9dcf5cf9120705baa9d5566b5.png" class="allowinvert" width="720"></p>

前 30 秒，x264 的 VMAF 分数为 92.022，而 NVENC 在这里的表现比 x264 还要好，VMAF 分数达到了 93.56，而手机上的 mediacodec 则不出意外的垫底，只有 89.434 分，至少从数据上来看，mediacodec 的视频画质是不如 x264 和 NVENC 的。

从视频截图也能看出，手机 mediacodec 编码器与另两者存在一些画质差距，这个差距主要体现在人和衣服的纹理上，mediacodec 编码出的视频纹理存在更明显的涂抹痕迹，且颜色过渡不够自然：

![](https://img.wzq02.top/upl/020bc7c3ad1da31487a1d67cb839af8a.webp)

（左：mediacodec   中：NVENC    右：x264）

后 30 秒的视频画面变化更为频繁，时间和空间复杂度更高，此时三个编码器的 VMAF 数值都有所下降：

<p><img src="https://img.wzq02.top/upl/82a04cfd3e3b7a322bc167895a2f0b19.png" class="allowinvert" width="720"></p>

x264 的分数下降到了 89.434，而 NVENC 在后 30 秒的表现已经不如 x264，分数仅有 87.601，mediacodec 的分数则还要更低一些，为 87.157。

从截图来看，视频后半段尤其是暗部场景中，NVENC 和 mediacodec 编码器的视频画面出现了较为明显的色块和马赛克，无论是画面细节还是瑕疵的表现，都不如 x264：

![](https://img.wzq02.top/upl/57a0f692265b3d7aff8f8d09a7e92745.webp)

（左：mediacodec   中：NVENC    右：x264）

视频码率方面，虽然我为三个编码器都指定了 2.5Mbps 的目标码率，mediacodec 编码出来的视频实际码率为 2970kbps，是我设置的目标码率的 1.19 倍，而 x264 和 NVENC 的实际码率分别为 2771kbps 和 2667kbps，相对更低一些。mediacodec 实际码率更高，但视频画质却更差，这也就说明当今移动端平台的硬件视频编码器与 PC 上的视频编码单元相比，在视频画质和压缩率上，还是存在一定的差距。

接下来对比 H.265 视频编码。这次我还是使用同样的测试视频，同样把目标码率设置为 2.5Mbps。x265、NVENC 和 mediacodec 的编码速度分别如下：

<p><img src="https://img.wzq02.top/upl/b617339526a67791e22a4ab2cb6628d7.png" class="allowinvert" width="720"></p>

在 H.265 的测试中，CPU 与另外两个硬件编码器相差更大了，x265 速度只有 31.86fps，而 N 卡 NVENC 的速度为 370fps，8 Gen 2 的 mediacodec 则为 264fps，速度甚至比先前 H.264 的视频编码还快。

而在视频质量方面，这三个编码器出来的视频在前 30 秒的 VMAF 数值如下：

<p><img src="https://img.wzq02.top/upl/7882aca8c29d1dec48d3e192a46fb154.png" class="allowinvert" width="720"></p>

前 30 秒，x265 的分数最高，为 94.659 分，NVENC 其次，94.35 分，与 x265 相差不大，而 mediacodec 则再次垫底，只拿到了 90.996 分。

再来看后 30 秒的：

<p><img src="https://img.wzq02.top/upl/d3916deb9b1d24ca67a29c78ca509e8c.png" class="allowinvert" width="720"></p>

可以看出，相比 x264，x265 在复杂场景下 VMAF 的数值波动较小，分数仍能达到 93.47，而 NVENC 的表现也不错，后半段也有 92.517 分，但 mediacodec 的表现就差很多了，即使是编码 H.265 视频，在视频后 30 秒的分数仍然只有 88.026 分，画质较差。

实际上，mediacodec 在 H.265 下的分数还比不过 x264，mediacodec H.265 在前半段的分数比 x264 低了 1.026，后半段则比 x264 低了 1.408 分。

不过不同于上面 H.264 的测试的是，三种 H.265 编码器压制出来的视频实际码率较为接近。x265 实际码率相对较高，为 2837kbps，NVENC 为 2785kbps，而 mediacodec 这次反而是码率最低的，为 2668kbps。

那么三种编码器从 H.264 换到 H.265 之后，VMAF 数值分别提升了多少呢？

<p><img src="https://img.wzq02.top/upl/64bd74a4afd5c1c76060c65101f40df4.png" class="allowinvert" width="720"></p>

由以上这些数据可见，在画面较为简单的场景，手机 mediacodec 编码器编码 H.265 视频的收益是相对更大的，同码率下 VMAF 数值提升了 1.957。而在后 30 秒复杂场景下，mediacodec 在 H.265 下的收效就不明显了，相比 H.264 只提升了 0.869。相比起来，N 卡 NVENC 编码器在编码 H.265 视频时，复杂场景下相比 H.264 的优势更明显，与手机编码器的情况是反过来的。

这个结果并不让我感到意外，毕竟手机芯片需要严格控制功耗，视频编码器的设计复杂度并不能做到显卡的级别，而且手机视频编码器的应用场景更多是在视频拍摄上，更注重实时性而不是图像质量，因此手机芯片的视频编码水平自然就比不过 PC 端显卡和 CPU。

## 总结

这次对比实验的主要目的还是探究当下智能手机 CPU 在视频压制这一应用场景下能有电脑的几成功力，以及今天手机端硬件视频编码器的画质和效能是个什么水平。在 CPU 软件视频编码方面，8 Gen 2 使用 x264 编码 1080p 视频的速度能有个二三十来帧，已经可以应对一些非实时的视频压制需求了，而硬件编码方面，虽然手机的编码器在同码率画质和压缩比上还是比不过 PC 端显卡，但比起以前的手机也有很大进步了。对于手机编码器的应用场景来说，2.5Mbps 的码率并不算高，如果换成早些年的手机，在这个码率下压出来的视频估计得是全屏马赛克了。现今大部分智能手机的自带相机软件都会为 1080p 视频提供至少十多 M 的码率，在充足的码率下，手机拍摄视频的画质是会比上面的测试案例中好得多的。

虽然这篇文章的标题是“手机压片，可行否？”，但我快写完这篇文章时发现，对我来说，除了用手机拍视频，我很难想到自己会在什么场合下会需要专门用手机去压制视频，毕竟无论是视频剪辑、压制还是后期制作，在电脑上做这些事情肯定要比在手机上舒服的多。不过也确实有一些人因为自身的各种条件限制，没法在电脑上完成视频编辑和压制的工作，或者有些短视频博主可能需要在出门在外，没有携带电脑的情况下剪辑和压制视频，那这篇文章对于这些群体来说应该也有一定的参考意义。结合上面的各种测试来看，用当今的手机压片，也确实算是可行的...吧。

除已有版权内容外，本文其余部分采用 CC0 1.0 协议发布，转载请随意。